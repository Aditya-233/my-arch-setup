# TLP 1.8.0 — i5-13500H: Max performance on AC, Max battery on BAT

TLP_ENABLE=1
TLP_PERSISTENT_DEFAULT=0
TLP_DEFAULT_MODE=AC
TLP_WARN_LEVEL=3

# ------------ CPU ------------
# Intel HWP opmode: active = more autonomous; guided = more OS influence
CPU_DRIVER_OPMODE_ON_AC=active
CPU_DRIVER_OPMODE_ON_BAT=active

# Governors (intel_pstate supports performance/powersave)
CPU_SCALING_GOVERNOR_ON_AC=performance
CPU_SCALING_GOVERNOR_ON_BAT=powersave

# Energy/Perf Policy (EPP)
CPU_ENERGY_PERF_POLICY_ON_AC=performance
CPU_ENERGY_PERF_POLICY_ON_BAT=power

# P-state performance limits (0–100)
CPU_MIN_PERF_ON_AC=0
CPU_MAX_PERF_ON_AC=100
CPU_MIN_PERF_ON_BAT=0
CPU_MAX_PERF_ON_BAT=20   # Extreme battery; if laggy, try 30–35

# Turbo / HWP Dyn Boost
CPU_BOOST_ON_AC=1
CPU_BOOST_ON_BAT=0
CPU_HWP_DYN_BOOST_ON_AC=1
CPU_HWP_DYN_BOOST_ON_BAT=0

# Consolidate tasks on fewer cores under light load
SCHED_POWERSAVE_ON_AC=0
SCHED_POWERSAVE_ON_BAT=1

# Disable NMI watchdog (saves power)
NMI_WATCHDOG=0

# ------------ Platform profile & sleep ------------
PLATFORM_PROFILE_ON_AC=performance
PLATFORM_PROFILE_ON_BAT=low-power
# For max battery on suspend:
MEM_SLEEP_ON_AC=s2idle
MEM_SLEEP_ON_BAT=deep

# ------------ Disks / Storage ------------
DISK_DEVICES="nvme0n1"
DISK_APM_LEVEL_ON_AC="254 254"
DISK_APM_LEVEL_ON_BAT="192 192"
DISK_APM_CLASS_DENYLIST="usb ieee1394"
DISK_SPINDOWN_TIMEOUT_ON_AC="0 0"
DISK_SPINDOWN_TIMEOUT_ON_BAT="0 0"
DISK_IOSCHED="keep keep"

# SATA link power (has effect only if SATA present)
SATA_LINKPWR_ON_AC="med_power_with_dipm max_performance"
SATA_LINKPWR_ON_BAT="med_power_with_dipm min_power"

AHCI_RUNTIME_PM_ON_AC=on
AHCI_RUNTIME_PM_ON_BAT=auto
AHCI_RUNTIME_PM_TIMEOUT=15

BAY_POWEROFF_ON_AC=0
BAY_POWEROFF_ON_BAT=1
BAY_DEVICE="sr0"

# ------------ Filesystem writeback ------------
DISK_IDLE_SECS_ON_AC=0
DISK_IDLE_SECS_ON_BAT=5
MAX_LOST_WORK_SECS_ON_AC=15
MAX_LOST_WORK_SECS_ON_BAT=90

# ------------ PCIe & Runtime PM ------------
# Max battery can use powersupersave; if instability, change to powersave
PCIE_ASPM_ON_AC=default
PCIE_ASPM_ON_BAT=powersupersave

RUNTIME_PM_ON_AC=on
RUNTIME_PM_ON_BAT=auto
# Example: denylist problematic devices (use lspci to get IDs)
#RUNTIME_PM_DENYLIST="02:00.0 03:00.0"
#RUNTIME_PM_DRIVER_DENYLIST="nouveau radeon amdgpu"

# ------------ USB ------------
USB_AUTOSUSPEND=1
USB_EXCLUDE_AUDIO=1
USB_EXCLUDE_BTUSB=0    # 0 = allow autosuspend for maximum battery
USB_EXCLUDE_PHONE=1
USB_EXCLUDE_PRINTER=1
USB_EXCLUDE_WWAN=0
# If Bluetooth audio stutters, set USB_EXCLUDE_BTUSB=1 instead
USB_AUTOSUSPEND_DISABLE_ON_SHUTDOWN=0

# ------------ Radios ------------
WIFI_PWR_ON_AC=off
WIFI_PWR_ON_BAT=on
WOL_DISABLE=Y
RESTORE_DEVICE_STATE_ON_STARTUP=0
DEVICES_TO_DISABLE_ON_BAT_NOT_IN_USE="bluetooth"

# ------------ Audio ------------
SOUND_POWER_SAVE_ON_AC=0
SOUND_POWER_SAVE_ON_BAT=1
SOUND_POWER_SAVE_CONTROLLER=Y

# ------------ Battery care ------------
NATACPI_ENABLE=1
TPACPI_ENABLE=1
TPSMAPI_ENABLE=1

# ------------ TLP-RDW (optional) ------------
DEVICES_TO_DISABLE_ON_LAN_CONNECT="wifi wwan"
DEVICES_TO_DISABLE_ON_WIFI_CONNECT="wwan"
DEVICES_TO_DISABLE_ON_WWAN_CONNECT="wifi"
DEVICES_TO_ENABLE_ON_LAN_DISCONNECT="wifi"
